# Scala

Scala is a chart for creating Scala web applications.

## TL;DR;

```
$ helm install chatwork/scala
```

## Prerequisites

* Kubernetes 1.11+
* LoadBalancer support or Ingress Controller

## Installing the Chart


To install the chart with the release name `my-release`:

```
$ helm install --name my-release chatwork/scala
```

The command deploys the Scala chart on the Kubernetes cluster in the default configuration. The [configuration](https://github.com/chatwork/charts/tree/master/scala#configuration) section lists the parameters that can be configured during installation.

## Uninstalling the Chart

To uninstall/delete the `my-release` deployment:

```
$ helm delete my-release
```

The command removes all the Kubernetes components associated with the chart and deletes the release.

## Configuration

The following table lists the configurable parameters of the Scala chart and their default values.

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| affinity | object | {} |  |
| autoscaling.enabled | bool | false |  |
| fullnameOverride | string | "" |  |
| image.pullPolicy | string | "IfNotPresent" |  |
| image.pullSecrets | list | [] |  |
| image.repository | string | "cwozaki/scala-example" |  |
| image.tag | string | "latest" |  |
| ingress.enabled | bool | false |  |
| nameOverride | string | "" |  |
| nodeSelector | object | {} |  |
| podAnnotations | object | {} |  |
| podDisruptionBudget.enabled | bool | false |  |
| replicaCount | int | 1 |  |
| scala.configmaps | object | {} |  |
| scala.env | list | [] |  |
| scala.envFrom | list | [] |  |
| scala.javaOptions | list | [] |  |
| scala.port | int | 8080 |  |
| scala.requestTimeout | int | 30 |  |
| scala.secrets | object | {} |  |
| scala.volumeMounts | list | [] |  |
| scala.volumes | list | [] |  |
| service.type | string | "LoadBalancer" |  |
| strategy.type | string | "RollingUpdate" |  |
| test.enabled | bool | true |  |
| tolerations | list | [] |  |

## Tips

### Using sbt-native-packager

Scala charts supports [sbt-native-packager](https://www.scala-sbt.org/sbt-native-packager/formats/docker.html) by default.

```yaml
image:
  repository: [Docker image generated by sbt-native-packager]

  tag: latest
  
scala:
  port: [Port specified by dockerExposedPorts]
```

By default, sbt-native-packager also supports command arguments and `JVM_OPTS`.
They also support Scala charts.

```yaml
scala:
  command:
    - [Pass container argument]

  javaOptions:
    - [Extra JVM option]
```

### Heap settings

When setting the heap, hand over to `javaOptions` as an settings.
Also, in that case, you need to request `resources.requests` for memory larger than the heap.

```yaml
scala:
  javaOptions:
    - -Xms4096m
    - -Xmx4096m
    
  resources:
    requests:
      cpu: 4
      memory: 4096Mi
```

## Using lightbend config

When using it by injecting [lightbend config](https://github.com/lightbend/config), mount via ConfigMap/Secrets.

```yaml
scala:
  javaOptions:
  - -Dconfig.file=/opt/conf/application.conf

  volumes:
    - name: application-conf-volume
      configMap:
        name: '{{`{{template "scala.fullname" . }}`}}-application-conf'
  
  volumeMounts:
    - name: application-conf-volume
      mountPath: /opt/conf
  
  configmaps:
    application.conf: |
      ...
```

